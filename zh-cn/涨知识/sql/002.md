

长链接, 占用资源
查询缓存8.0 没有查询缓存

## 链接器
## 分析器 词法分析
## 优化器 该怎么做
## 执行器 * update 各种log
## 存储引擎


### WAL 先写日志,再写磁盘
redo log 固定大小

## 2阶段提交 逻辑上的一致
半个月的binlog
prepare
commit

redo写完 binlog 没写完
备份的binlog没有, 使用binlog就会少了一次更新
redo没写完, 这个事务无效, binlog多了一个事务

线上主从不一致


sync_binlog 每次事务的binlog都持久化到磁盘, 保证msyql异常重启后binlog不丢失
innodb_flush_log_at_trx_commit :每次事务的redo log持久化到磁盘 保证mysql异常重启后数据部丢失


## 事务

I Isolation 隔离性

隔离的实现

更新时记录一个回滚操作
多版本并发控制 : 同一条记录在系统中存在多个版本

回滚日志什么时候删除: 不需要:判断没有事务的会用的时候
长事务意味着存在很老的回滚日志, 提交之前都保留, 会占用大量的存储空间

begin
start transaction
commit

commit work and chain


n 叉书

索引是b+树  配合磁盘读写特性, 减少单次查询的磁盘访问次数
最左前缀原则:
    可以是联合索引的最左N个字段, 也可以是字符串索引的最左M个字符
索引下推优化 判断索引里字段是否符合条件

set global readonly = true , readonly 其他逻辑, 长时间不可写, 危险

metadata lock 会自动加上, 保证读写的正确性

