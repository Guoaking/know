

## 三次握手(3次才可以初始化Sockets, 窗口大小和初始序列号)

链接: 用户保证可靠性和流控机制的信息, 包括Socket, 序列号以及窗口大小
窗口大小: 流控制
序列号: 追踪通信发起方发送的数据包序号, 接收方可以通过序列号向发送方确认某个数据包的成功接收
Socket: 互联网地址标识符和端口组成的

1. 阻止重复历史链接的初始化, 防止双方建立了错误的链接*
   1. 2次:发送方发送出去, 接收方只能链接或者拒绝, 并不清楚这个请求是否不是由于网络拥堵而早早过期的链接(seq, rst)
   2. 使三次握手是否建立连接的最终控制权交给了发送方,(有足够的上下文判断)
2. 对通信双方的初始序列号进程初始化
   1. 可以通过序列号对重复的数据包进行去重(重复)
   2. 发送方会在对应数据包未被ACK时重复发送(丢失)
   3. 接收方可以根据数据包的序列号对他们进行重新排序(重排序)
3. 讨论其他次数握手建立连接的可能性
   1. 最多4次,5次都可以, 追求的是最少的通信次数完成信息交换
   2. 多余的资源消耗

## 弱网环境下TCP性能
1. 拥塞算法会在丢包时主动降低吞吐量
2. 三次握手增加了数据传输的延迟和额外开销
3. 累计应答机制导致了数据段的传输

udp -> quic
tcp -> 选择性ACK(Selective ACK, SACK), TCP快开启(TCP Fast Open)

### 粘包
并不是TCP协议造成的, 应为应用层协议设计者对TCP协议的错误理解

TCP面向字节流的协议, 可能会组合或者拆分应用层协议的数据
应用层协议的没有定义消息的边界导致数据接收方无法拼接数据

应用层消息的边界: 基于长度(http), 或者基于终结符

DNS(domain name system)
循环依赖 胶水记录
: dig -t A domain +trace

数据包的大小
DNS使用UDP: 数据包小, 机制简单, 开销小, 更好的性能表现
DNS不止使用UDP
DNS区域传输, AXFR类型 使用TCP
UDP512字节, 超过会被截断, TCP重传
MTU(单个数据包大小的上限 1500字节): 数据包可能会被分片,丢弃, 拒绝